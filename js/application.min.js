/* Vitezslav Benes 2015*/

function init(){byId("pair-list").addEventListener("click",function(a){a.target&&"LI"===a.target.nodeName&&makeConnection(a.target)})}function refresh(){for(var a=byId("pair-list");a.firstChild;)a.removeChild(a.firstChild);leftcol=document.createElement("ul"),rightcol=document.createElement("ul"),leftcol.id="leftcol",rightcol.id="rightcol",a.appendChild(leftcol),a.appendChild(rightcol)}function makeVisualConnection(){var a=lineNodes[0].getBoundingClientRect(),b=lineNodes[1].getBoundingClientRect(),c=byId("pair-list").getBoundingClientRect(),d=a.bottom-a.top,e=b.bottom-b.top,f={x:a.right,y:a.top+d/2},g={x:b.left,y:b.top+e/2},h=g.y-f.y,i=g.x-f.x,j=Math.sqrt(Math.pow(h,2)+Math.pow(i,2)),k=round(Math.asin(h/j)*(180/Math.PI),1),l={x:f.x+i/2-j/2-c.left,y:f.y+h/2-c.top+3},m=document.createElement("span");m.className="line",m.dataset.a=lineNodes[0].innerHTML,m.dataset.b=lineNodes[1].innerHTML,m.dataset.keyindex=lineNodes[0].dataset.keyindex,m.dataset.valueindex=lineNodes[1].dataset.valueindex,m.style.width=round(j,1)+"px",m.style.marginTop=round(l.y,1)+"px",m.style.marginLeft=round(l.x,1)+"px",m.style.webkitTransform="rotate("+k+"deg)",m.style.MozTransform="rotate("+k+"deg)",m.style.msTransform="rotate("+k+"deg)",m.style.OTransform="rotate("+k+"deg)",m.style.transform="rotate("+k+"deg)",byId("pair-list").appendChild(m)}function makeConnection(a){a.dataset.keyindex&&lineNodes[0]?lineNodes[0].className="":a.dataset.valueindex&&lineNodes[1]&&(lineNodes[1].className=""),a.className=-1===a.className.indexOf("connect")||-1!==a.className.indexOf("mistake")?"connect":"";var b=byClassName("line");if(b.length>0)for(i=0;i<b.length;i++)b[i].dataset.keyindex===a.dataset.keyindex?b[i].parentNode.removeChild(b[i]):b[i].dataset.valueindex===a.dataset.valueindex&&b[i].parentNode.removeChild(b[i]);a.dataset.keyindex?(connection[0]=a.innerHTML,lineNodes[0]=a):(connection[1]=a.innerHTML,lineNodes[1]=a),connection[0]&&connection[1]&&(makeVisualConnection(),setTimeout(function(){clearClass("connect")},300),connection=[]);var b=byClassName("line");byId("checkbutton").disabled=b.length!==pairsInUse.length?!0:!1}function clearClass(a){var b=byClassName(a);0!==b.length&&(b[1].className=b[1].className.replace(a,""),b[0].className=b[0].className.replace(a,""))}function checkPairs(){var a=byClassName("line"),b=getChildrenOfId("leftcol"),c=getChildrenOfId("rightcol");if(a.length===pairsInUse.length){for(i=0;i<pairsInUse.length;i++)for(j=0;j<a.length;j++)pairsInUse[i][0]===a[j].dataset.a&&pairsInUse[i][1]===a[j].dataset.b?(b[a[j].dataset.keyindex].className="correct",c[a[j].dataset.valueindex].className="correct"):pairsInUse[i][0]===a[j].dataset.a&&pairsInUse[i][1]!==a[j].dataset.b&&(b[a[j].dataset.keyindex].className="mistake",c[a[j].dataset.valueindex].className="mistake",mistakes++);0===byClassName("mistake").length&&setTimeout(generatePairs,1e3)}else message("Please connect all bubbles.")}function displayScore(){var a="Your score is "+round((pairDatabase.length-mistakes)/pairDatabase.length*100,2)+" % = "+(pairDatabase.length-mistakes)+" / "+pairDatabase.length;message(a)}function message(a){var b=document.createElement("div");b.id="message";var c=document.createElement("span");c.innerHTML=a;var d=document.createElement("span");d.id="remove-message",d.innerHTML="X";var e=byTag("main")[0];return e.insertBefore(b,e.childNodes[0]),byId("message").appendChild(c),byId("message").appendChild(d),byId("remove-message").addEventListener("click",function(){byId("remove-message").parentNode.parentNode.removeChild(byId("remove-message").parentNode)}),!0}function generatePairs(){refresh(),byId("startbutton").disabled=!0,byId("checkbutton").disabled=!0;var a=minPairsGenerated,b=[],c=[];pairsInUse=[];var d=pairDatabase.length-indexesUsed.length;for(a>d&&(a=d),d||(displayScore(),message("You can fin more at http://gkolin.cz/index.php?p=28"),byId("startbutton").disabled=!1,byId("startbutton").innerHTML="start over",indexesUsed=[]);a!==b.length;){var e=Math.floor(Math.random()*pairDatabase.length);-1===b.indexOf(e)&&-1===indexesUsed.indexOf(e)&&b.push(e)}for(i=0;i<b.length;i++)pairsInUse.push(pairDatabase[b[i]]),indexesUsed.push(b[i]);for(i=0;i<pairsInUse.length;i++)c[i]=pairsInUse[i][1];for(shuffleArray(c),i=0;i<a;i++){var f=document.createElement("li");f.innerHTML=pairsInUse[i][0],f.setAttribute("data-keyIndex",i),byId("leftcol").appendChild(f);var g=document.createElement("li");g.innerHTML=c[i],g.setAttribute("data-valueIndex",i),byId("rightcol").appendChild(g)}}function shuffleArray(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function getChildrenOfId(a){for(var b=byId(a).childNodes,c=[],d=-1,e=b.length;++d!==e;c[d]=b[d]);return c}function round(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function byTag(a){return document.getElementsByTagName(a)}function byClassName(a){return document.getElementsByClassName(a)}function byId(a){return document.getElementById(a)}var pairDatabase=[["Logen","Nine-fingers"],["Thorin","Oakenshield"],["Kvothe","Kote"],["Master","Elodin"],["Jon","Snow"],["Tywin","Lannister"],["Tyrion","Lannister"],["Harry","Dresden"],["Bilbo","Baggins"],["Max","McDaniels"],["Dorian","Grey"],["Arya","Stark"],["Euron","Greyjoy"],["Daenarys","Targaryen"]],minPairsGenerated=8,pairsInUse=[],indexesUsed=[],connection=[],lineNodes=[],mistakes=0;document.addEventListener("DOMContentLoaded",init);
//# sourceMappingURL=application.min.js.map