function init(){byId("pair-list").addEventListener("click",function(e){e.target&&"LI"===e.target.nodeName&&makeConnection(e.target)})}function refresh(){for(var e=byId("pair-list");e.firstChild;)e.removeChild(e.firstChild);leftcol=document.createElement("ul"),rightcol=document.createElement("ul"),leftcol.id="leftcol",rightcol.id="rightcol",e.appendChild(leftcol),e.appendChild(rightcol)}function makeVisualConnection(){var e=lineNodes[0].getBoundingClientRect(),a=lineNodes[1].getBoundingClientRect(),t=byId("pair-list").getBoundingClientRect(),n=e.bottom-e.top,i=a.bottom-a.top,s={x:e.right,y:e.top+n/2},r={x:a.left,y:a.top+i/2},d=r.y-s.y,o=r.x-s.x,l=Math.sqrt(Math.pow(d,2)+Math.pow(o,2)),c=round(Math.asin(d/l)*(180/Math.PI),1),m={x:s.x+o/2-l/2-t.left,y:s.y+d/2-t.top+3},u=document.createElement("span");u.className="line",u.dataset.a=lineNodes[0].innerHTML,u.dataset.b=lineNodes[1].innerHTML,u.dataset.keyindex=lineNodes[0].dataset.keyindex,u.dataset.valueindex=lineNodes[1].dataset.valueindex,u.style.width=round(l,1)+"px",u.style.marginTop=round(m.y,1)+"px",u.style.marginLeft=round(m.x,1)+"px",u.style.webkitTransform="rotate("+c+"deg)",u.style.MozTransform="rotate("+c+"deg)",u.style.msTransform="rotate("+c+"deg)",u.style.OTransform="rotate("+c+"deg)",u.style.transform="rotate("+c+"deg)",byId("pair-list").appendChild(u)}function makeConnection(e){e.dataset.keyindex&&lineNodes[0]?lineNodes[0].className="":e.dataset.valueindex&&lineNodes[1]&&(lineNodes[1].className=""),e.className=-1===e.className.indexOf("connect")||-1!==e.className.indexOf("mistake")?"connect":"";var a=byClassName("line");if(a.length>0)for(i=0;i<a.length;i++)a[i].dataset.keyindex===e.dataset.keyindex?a[i].parentNode.removeChild(a[i]):a[i].dataset.valueindex===e.dataset.valueindex&&a[i].parentNode.removeChild(a[i]);e.dataset.keyindex?(connection[0]=e.innerHTML,lineNodes[0]=e):(connection[1]=e.innerHTML,lineNodes[1]=e),connection[0]&&connection[1]&&(makeVisualConnection(),setTimeout(function(){clearClass("connect")},300),connection=[]);var a=byClassName("line");byId("checkbutton").disabled=a.length!==pairsInUse.length?!0:!1}function clearClass(e){var a=byClassName(e);0!==a.length&&(a[1].className=a[1].className.replace(e,""),a[0].className=a[0].className.replace(e,""))}function checkPairs(){var e=byClassName("line"),a=getChildrenOfId("leftcol"),t=getChildrenOfId("rightcol");if(e.length===pairsInUse.length){for(i=0;i<pairsInUse.length;i++)for(j=0;j<e.length;j++)pairsInUse[i][0]===e[j].dataset.a&&pairsInUse[i][1]===e[j].dataset.b?(a[e[j].dataset.keyindex].className="correct",t[e[j].dataset.valueindex].className="correct"):pairsInUse[i][0]===e[j].dataset.a&&pairsInUse[i][1]!==e[j].dataset.b&&(a[e[j].dataset.keyindex].className="mistake",t[e[j].dataset.valueindex].className="mistake",mistakes++);0===byClassName("mistake").length&&setTimeout(generatePairs,1e3)}else message("Please connect all bubbles.")}function displayScore(){var e="Your score is "+round((pairDatabase.length-mistakes)/pairDatabase.length*100,2)+" % = "+(pairDatabase.length-mistakes)+" / "+pairDatabase.length;message(e)}function message(e){var a=document.createElement("div");a.id="message";var t=document.createElement("span");t.innerHTML=e;var n=document.createElement("span");n.id="remove-message",n.innerHTML="X";var i=byTag("main")[0];return i.insertBefore(a,i.childNodes[0]),byId("message").appendChild(t),byId("message").appendChild(n),byId("remove-message").addEventListener("click",function(){byId("remove-message").parentNode.parentNode.removeChild(byId("remove-message").parentNode)}),!0}function generatePairs(){refresh(),byId("startbutton").disabled=!0,byId("checkbutton").disabled=!0;var e=minPairsGenerated,a=[],t=[];pairsInUse=[];var n=pairDatabase.length-indexesUsed.length;for(e>n&&(e=n),n||(displayScore(),message("You can fin more at http://gkolin.cz/index.php?p=28"),byId("startbutton").disabled=!1,byId("startbutton").innerHTML="start over",indexesUsed=[]);e!==a.length;){var s=Math.floor(Math.random()*pairDatabase.length);-1===a.indexOf(s)&&-1===indexesUsed.indexOf(s)&&a.push(s)}for(i=0;i<a.length;i++)pairsInUse.push(pairDatabase[a[i]]),indexesUsed.push(a[i]);for(i=0;i<pairsInUse.length;i++)t[i]=pairsInUse[i][1];for(shuffleArray(t),i=0;i<e;i++){var r=document.createElement("li");r.innerHTML=pairsInUse[i][0],r.setAttribute("data-keyIndex",i),byId("leftcol").appendChild(r);var d=document.createElement("li");d.innerHTML=t[i],d.setAttribute("data-valueIndex",i),byId("rightcol").appendChild(d)}}function shuffleArray(e){for(var a,t,n=e.length;n;a=Math.floor(Math.random()*n),t=e[--n],e[n]=e[a],e[a]=t);return e}function getChildrenOfId(e){for(var a=byId(e).childNodes,t=[],n=-1,i=a.length;++n!==i;t[n]=a[n]);return t}function round(e,a){return Math.round(e*Math.pow(10,a))/Math.pow(10,a)}function byTag(e){return document.getElementsByTagName(e)}function byClassName(e){return document.getElementsByClassName(e)}function byId(e){return document.getElementById(e)}var pairDatabase=[["Sofoklés","Král Oidipús"],["Boccaccio, Giovanni","Dekameron"],["Komenský, Jan Amos","Labyrint světa a ráj srdce"],["Neruda, Jan","Balady a romance"],["Wilde, Oscar","Jak je důležité míti Filipa"],["Salinger, Jerome David","Kdo chytá v žitě"],["Čapek, Karel","RUR"],["Svěrák a Smoljak","Posel z Liptákova"],["Vančura, Vladislav","Rozmarné léto"],["Bradbury, Ray","451 ° Fahrenheita"],["Kafka, Franz","Proměna"],["Williams, Tennessee","Kočka na rozpálené plechové střeše"]],minPairsGenerated=8,pairsInUse=[],indexesUsed=[],connection=[],lineNodes=[],mistakes=0;document.addEventListener("DOMContentLoaded",init);