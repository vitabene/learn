/* Vitezslav Benes 2015*/

function init(){generatePairs(),byId("pair-list").addEventListener("click",function(a){a.target&&"LI"===a.target.nodeName&&makeConnection(a.target)})}function makeVisualConnection(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect(),e=byId("pair-list").getBoundingClientRect(),f=c.bottom-c.top,g=d.bottom-d.top,h={x:c.right,y:c.top+f/2},i={x:d.left,y:d.top+g/2},j=i.y-h.y,k=i.x-h.x,l=Math.sqrt(Math.pow(j,2)+Math.pow(k,2)),m=round(Math.asin(j/l)*(180/Math.PI),1),n={x:h.x+k/2-l/2-e.left,y:h.y+j/2-e.top+3},o=document.createElement("span");"correct"===a.className?o.className="line-correct":(o.className="line",o.dataset.a=a.innerHTML,o.dataset.b=b.innerHTML,o.dataset.keyindex=a.dataset.keyindex,o.dataset.valueindex=b.dataset.valueindex),o.style.width=round(l,1)+"px",o.style.marginTop=round(n.y,1)+"px",o.style.marginLeft=round(n.x,1)+"px",o.style.webkitTransform="rotate("+m+"deg)",o.style.MozTransform="rotate("+m+"deg)",o.style.msTransform="rotate("+m+"deg)",o.style.OTransform="rotate("+m+"deg)",o.style.transform="rotate("+m+"deg)",byId("pair-list").appendChild(o)}function makeConnection(a){isKey(a)&&lineNodes[0]?lineNodes[0].className="":isValue(a)&&lineNodes[1]&&(lineNodes[1].className=""),a.className="connect"!==a.className?"connect":"";var b=byClassName("line");if(b.length>0)for(i=0;i<b.length;i++)b[i].dataset.keyindex===a.dataset.keyindex?b[i].parentNode.removeChild(b[i]):b[i].dataset.valueindex===a.dataset.valueindex&&b[i].parentNode.removeChild(b[i]);a.dataset.keyindex?lineNodes[0]=a:lineNodes[1]=a,lineNodes[0]&&lineNodes[1]&&(makeVisualConnection(lineNodes[0],lineNodes[1]),setTimeout(function(){clearClass("connect")},300),lineNodes=[]);var b=byClassName("line"),c=byClassName("line-correct").length;byId("checkbutton").disabled=b.length!==pairsInUse.length-c?!0:!1}function checkPairs(){removeTagWithClass("line"),0===mistakes?setTimeout(function(){generatePairs(),removeAllChildren("pair-list")},1e3):setTimeout(function(){clearClass("mistake")},1e3)}function displayScore(){var a="Your score is "+round((pairDatabase.length-mistakes)/pairDatabase.length*100,2)+" % = "+(pairDatabase.length-mistakes)+" / "+pairDatabase.length;message(a)}function generatePairs(){var a=minPairsGenerated,b=[],c=pairDatabase.length-indexesUsed.length,d=byId("startbutton"),e=byId("checkbutton");d.style.display="none",e.disabled=!0,pairsInUse=[],a>c&&(a=c),c||(displayScore(),d.style.display="inline-block",d.innerHTML="start over",indexesUsed=[]),indexesFromDB=randomIndexesFromDB(a,pairDatabase),pairsInUse=pairArrayFromIndexes(indexesFromDB,pairDatabase),indexesUsed.concat(indexesFromDB);for(var f=0;f<pairsInUse.length;f++)b.push(pairsInUse[f].valueNode);for(shuffleArray(b),f=0;a>f;f++){var g=pairsInUse[f].keyNode,h=b[f];g.id="k"+f,h.id="v"+f,byId("leftcol").appendChild(g),byId("rightcol").appendChild(h)}}function Pair(a,b){this.createLiNode=function(a){var b=document.createElement("li");return b.innerHTML=a,b},this.keyNode=this.createLiNode(a),this.valueNode=this.createLiNode(b),this.assignedNode}function Connection(){}function shuffleArray(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function getChildrenOfId(a){for(var b=byId(a).childNodes,c=[],d=-1,e=b.length;++d!==e;c[d]=b[d]);return c}function round(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function byTag(a){return document.getElementsByTagName(a)}function byClassName(a){return document.getElementsByClassName(a)}function byId(a){return document.getElementById(a)}function clearClass(a){var b=byClassName(a);if(0!==b.length)for(var c=b.length-1;c>=0;c--)b[c].className=b[c].className.replace(a,"")}function message(a){var b=document.createElement("div");b.id="message";var c=document.createElement("span");c.innerHTML=a;var d=document.createElement("span");d.id="remove-message",d.innerHTML="X";var e=byTag("main")[0];return e.insertBefore(b,e.childNodes[0]),byId("message").appendChild(c),byId("message").appendChild(d),byId("remove-message").addEventListener("click",function(){byId("remove-message").parentNode.parentNode.removeChild(byId("remove-message").parentNode)}),!0}function removeTagWithClass(a){for(var b=document.getElementsByClassName(a);b[0];)b[0].parentNode.removeChild(b[0])}function arrayFromCollection(a){for(var b=[],c=0;c<a.length;c++){var d=[];d.push(a[c].dataset.a),d.push(a[c].dataset.b),b.push(d)}return b}function removeAllChildren(a){for(var b=byId(a);b.firstChild;)b.removeChild(b.firstChild);leftcol=document.createElement("ul"),rightcol=document.createElement("ul"),leftcol.id="leftcol",rightcol.id="rightcol",b.appendChild(leftcol),b.appendChild(rightcol)}function isKey(a){return"k"===a.id.substring(0,1)?!0:!1}function isValue(a){return"v"===a.id.substring(0,1)?!0:!1}function findKey(a,b){for(var c=0;c<a.length;c++)if(a[b])return a[b];return!1}function randomIndexesFromDB(a,b){for(var c=[];a!==c.length;){var d=Math.floor(Math.random()*b.length);-1===c.indexOf(d)&&c.push(d)}return c}function pairArrayFromIndexes(a,b){for(var c=[],d=0;d<a.length;d++){var e=new Pair(b[a[d]][0],b[a[d]][1]);c.push(e)}return c}var pairDatabase=[["Logen","Nine-fingers"],["Thorin","Oakenshield"],["Kvothe","Kote"],["Master","Elodin"],["Jon","Snow"],["Tywin","Lannister"]],minPairsGenerated=8,pairsInUse=[],indexesUsed=[],lineNodes=[],mistakes=0;document.addEventListener("DOMContentLoaded",init);
//# sourceMappingURL=application.min.js.map