/* Vitezslav Benes 2015*/

function round(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function byTag(a){return document.getElementsByTagName(a)}function byClassName(a){return document.getElementsByClassName(a)}function byId(a){return document.getElementById(a)}function shuffleArray(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function getChildrenOfId(a){for(var b=byId(a).childNodes,c=[],d=-1,e=b.length;++d!==e;c[d]=b[d]);return c}function clearClass(a){var b=byClassName(a);if(0!==b.length)for(var c=b.length-1;c>=0;c--)b[c].className=b[c].className.replace(a,"")}function removeNodesWithClass(a){for(var b=document.getElementsByClassName(a);b[0];)b[0].parentNode.removeChild(b[0])}function arrayFromCollection(a){for(var b=[],c=0;c<a.length;c++){var d=[];d.push(a[c].dataset.a),d.push(a[c].dataset.b),b.push(d)}return b}function removeAllChildren(a){for(var b=byId(a);b.firstChild;)b.removeChild(b.firstChild)}function isKey(a){return"k"===a.id.substring(0,1)?!0:!1}function findKey(a,b){for(var c=0;c<a.length;c++)if(a[b])return a[b];return!1}function randomIndexesFromDB(a,b,c){for(var d=[];a!==d.length;){var e=Math.floor(Math.random()*b.length);-1===d.indexOf(e)&&-1===c.indexOf(e)&&(d.push(e),c.push(e))}return d}function pairArrayFromIndexes(a,b){for(var c=[],d=0;d<a.length;d++){var e=new Pair(b[a[d]][0],b[a[d]][1]);c.push(e)}return c}function Line(a,b,c){var d=[a.getBoundingClientRect(),b.getBoundingClientRect(),c.getBoundingClientRect()],e=d[0].bottom-d[0].top,f={x:d[0].right,y:d[0].top+e/2},g={x:d[1].left,y:d[1].top+e/2},h={x:g.x-f.x,y:g.y-f.y},i=Math.sqrt(Math.pow(h.x,2)+Math.pow(h.y,2)),j=Math.asin(h.y/i)*(180/Math.PI),k={x:f.x+(h.x-i)/2-d[2].left,y:f.y+h.y/2-d[2].top};this.lineElement=document.createElement("span"),this.lineElement.className="line";var l=function(a){a.style.width=round(i,1)+"px",a.style.marginTop=round(k.y,1)+"px",a.style.marginLeft=round(k.x,1)+"px",0!==j&&(a.style.webkitTransform=a.style.MozTransform=a.style.msTransform=a.style.OTransform=a.style.transform="rotate("+round(j,1)+"deg)")};l(this.lineElement);var m=a.id;return this.lineElement.id="l"+m.substring(m.length-1),b.id="v"+m.substring(m.length-1),this.lineElement}function Pair(a,b){this.createLiNode=function(a){var b=document.createElement("li");return b.innerHTML=a,b},this.setValue=function(a){this.assignedValue=a},this.check=function(){return this.valueNode.innerHTML===this.assignedValue?(this.markCorrect(),this.moveUp(),!0):(this.highlightMistake(),!1)},this.drawLine=function(a,b){this.line=b,a.appendChild(this.line)},this.removeLine=function(){this.line.parentNode.removeChild(this.line)},this.moveUp=function(){var a=this.keyNode.parentNode,b=this.valueNode.parentNode;a.removeChild(this.keyNode),b.removeChild(this.valueNode),a.insertBefore(this.keyNode,a.childNodes[0]),b.insertBefore(this.valueNode,b.childNodes[0])},this.markCorrect=function(){this.keyNode.className="correct",this.valueNode.className="correct"},this.highlightMistake=function(){this.keyNode.className="mistake",this.valueNode.className="mistake"},this.keyNode=this.createLiNode(a),this.valueNode=this.createLiNode(b),this.assignedValue,this.line}function App(){var a=4,b=[],c=[],d=[],e=0,f=0,g=[];this.getPairDatabase=function(){return g},this.setPairDatabase=function(a){return g=a,!0},this.populateDatabase=function(a){var b=this;""!=a&&(xmlhttp=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState&&200==xmlhttp.status){var a=JSON.parse(xmlhttp.responseText),c=[];return Object.keys(a).map(function(b){var d=Array(b).concat(a[b]);c.push(d)}),void b.setPairDatabase(c)}},xmlhttp.open("GET","getpairs.php?id="+a,!0),xmlhttp.send())},this.generatePairs=function(){console.log("gen");console.log(window.app.getPairDatabase()),console.log(this);var d=a,e=[],f=g.length-c.length,h=byId("startbutton"),i=(byId("checkbutton"),[]);h.style.display="none",b=[],removeAllChildren("rightcol"),removeAllChildren("leftcol"),d>f&&(d=f),f||isNaN(this.getScore())||(this.notify(this.getScore(),byTag("main")[0]),h.style.display="inline-block",h.innerHTML="start over",c=[]),indexesFromDB=randomIndexesFromDB(d,this.getPairDatabase(),c),b=pairArrayFromIndexes(indexesFromDB,this.getPairDatabase()),c.concat(indexesFromDB);for(var j=0;j<b.length;j++)e.push(b[j].valueNode);for(shuffleArray(e),j=0;d>j;j++){var k=b[j].keyNode,l=e[j];k.id="k"+j,i[k.id]=b[j],byId("leftcol").appendChild(k),byId("rightcol").appendChild(l)}b=i},this.connect=function(a){if("selected"!==a.className?a.className="selected":a.removeAttribute("class"),isKey(a)&&d.key?d.key.removeAttribute("class"):!isKey(a)&&d.value&&d.value.removeAttribute("class"),a.id){var c=a.id.substring(a.id.length-1),e="l"+c,f="v"+c;byId(e)&&byId(e).parentNode.removeChild(byId(e)),byId(f)&&byId(f).removeAttribute("id")}if(isKey(a)?d.key=a:d.value=a,d.key&&d.value){var g=b[d.key.id];g.setValue(d.value.innerHTML),byId("pair-list").appendChild(new Line(d.key,d.value,byId("pair-list"))),setTimeout(function(){clearClass("selected")},300),d=[]}},this.notify=function(a,b){var c=document.createElement("div"),d=document.createElement("span"),e=document.createElement("span");return c.id="message",d.innerHTML=a,e.id="remove-message",e.innerHTML="X",c.appendChild(d),c.appendChild(e),b.insertBefore(c,b.firstChild),e.addEventListener("click",function(){b.removeChild(this.parentNode)}),!0},this.checkPairs=function(){var c=byClassName("line");if(c.length+f>=a){d=[];for(var g=e,h=c.length+f%4-1;h>=0;h--)"correct"!==b["k"+h].keyNode.className&&(b["k"+h].check()?f++:e++);for(var i=byId("rightcol"),h=0;h<i.childNodes.length;h++)i.childNodes[h].removeAttribute("id");if(g===e){var j=this;setTimeout(function(){j.generatePairs()},1e3)}else setTimeout(function(){clearClass("mistake")},1e3);removeNodesWithClass("line")}else this.notify("Please connect all bubbles.",byTag("main")[0])},this.getScore=function(){var a="Your score is "+round((g.length-e)/g.length*100,2)+" % = "+(g.length-e)+" / "+g.length;return a}}var app;document.addEventListener("DOMContentLoaded",function(){app=new App,byId("checkbutton")&&byId("checkbutton").addEventListener("click",function(){app.checkPairs()}),byId("startbutton")&&byId("startbutton").addEventListener("click",function(){app.populateDatabase(byId("startbutton").dataset.set),app.generatePairs()}),byId("pair-list")&&byId("pair-list").addEventListener("click",function(a){a.target&&"LI"===a.target.nodeName&&app.connect(a.target)})});
//# sourceMappingURL=application.min.js.map